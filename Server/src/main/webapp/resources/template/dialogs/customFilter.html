<link rel="stylesheet" href="/resources/css/dialogs/customFilter.css">

<div class="modal fade" id="customFilterDialogId" ng-controller="customFilterController">
    <div class="modal-dialog custom-filter-dialog">
        <div class="modal-content">
            <div class="modal-header modal-find">
                <div ng-repeat="element in filterRequest" class="current-filter-expression">
                    <div class="filter-part">
                        {{element.field.info.name}} {{element.oper.info.symbol}}
                        <span ng-if="!typeWithMultiplyParams(element.oper.info.name)">
                            <span ng-if="element.field.info.type === 'dateTime'">{{element.param.info.values[0] | date:'medium'}}</span>
                            <span ng-if="element.field.info.type !== 'dateTime'">{{element.param.info.values[0]}}</span>
                        </span>


                        <span ng-if="typeWithMultiplyParams(element.oper.info.name)"> ,
                            <span ng-if="element.field.info.type == 'dateTime'">{{element.param.info.values[1] |date:'medium'}}</span>
                            <span ng-if="element.field.info.type != 'dateTime'">{{element.param.info.values[1]}}</span>
                        </span>
                        <i class="fa fa-times" aria-hidden="true" ng-click="removeFromRequest($index)"></i>
                    </div>
                    <span ng-if="!$last">{{translate(logicalExpression)}}</span>
                </div>
                <div ng-if="currentFilterExpression.field" class="current-filter-expression">
                    {{currentFilterExpression.field.info.name}} {{currentFilterExpression.oper.info.symbol}}
                    {{currentFilterExpression.param.info.values[0]}}
                    <span ng-if="typeWithMultiplyParams(currentFilterExpression.oper.info.name)"> , {{currentFilterExpression.param.info.values[1]}}</span>
                </div>
            </div><!-- /.modal-header -->
            <div class="modal-body modal-find">
                <div class="filter-body" layout="row">
                    <div flex="70">
                        <table class="table table-hover">
                            <thead>
                            <tr>
                                <th>{{translate("title")}}</th>
                                <th>{{translate("name")}}</th>
                                <th>{{translate("type")}}</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr ng-repeat="filterInfo in filtersInfo" class="selected-row"
                                ng-click="addField(filterInfo)">
                                <td>{{translate(filterInfo.title)}}</td>
                                <td>{{filterInfo.field}}</td>
                                <td>{{translate(filterInfo.type+"_field")}}</td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                    <div flex="30"  layout-margin ng-scrollbars ng-scrollbars-config="selectScrollConfig">
                        <div ng-if="currentFilterExpression.field && !isParamsInput"
                             ng-switch="currentFilterExpression.field.info.type">
                            <div ng-switch-when="text">
                                <md-radio-group ng-model="selectedOperation.value">
                                    <md-radio-button ng-value="value" class="md-primary" ng-repeat="value in operationMap.text.values">
                                        {{translate("operation_" + value.name)}}
                                    </md-radio-button>
                                </md-radio-group>
                            </div>
                            <div ng-switch-when="number">
                                <md-radio-group ng-model="selectedOperation.value">
                                    <md-radio-button ng-value="value" class="md-primary" ng-repeat="value in operationMap.number.values">
                                        {{translate("operation_" + value.name)}}
                                    </md-radio-button>
                                </md-radio-group>
                            </div>
                            <div ng-switch-when="dateTime">
                                <md-radio-group ng-model="selectedOperation.value">
                                    <md-radio-button ng-value="value" class="md-primary" ng-repeat="value in operationMap.dateTime.values">
                                        {{translate("operation_" + value.name)}}
                                    </md-radio-button>
                                </md-radio-group>
                            </div>
                            <div ng-switch-when="enum">
                                <md-radio-group ng-model="selectedOperation.value">
                                    <md-radio-button ng-value="value" class="md-primary" ng-repeat="value in operationMap.enum.values">
                                        {{translate("operation_" + value.name)}}
                                    </md-radio-button>
                                </md-radio-group>
                            </div>
                            <div ng-switch-default>
                                <md-radio-group ng-model="selectedOperation.value">
                                    <md-radio-button ng-value="value" class="md-primary" ng-repeat="value in operationMap.other.values">
                                        {{translate("operation_" + value.name)}}
                                    </md-radio-button>
                                </md-radio-group>
                            </div>
                            <div>
                                <button class="btn btn-default" ng-if="selectedOperation.value"
                                        ng-click="addOperation()">{{translate("next")}}
                                </button>
                            </div>
                        </div>
                        <div ng-if="isParamsInput">
                            <div ng-switch="currentFilterExpression.field.info.type">
                                <div ng-switch-when="text">
                                    <div ng-if="selectedOperation.value.name === 'in'" ng-init="inParams = [{}]">
                                        <a href="" ng-click="inParams.push({})">{{translate("add_param")}}</a>
                                        <div class="form-group" ng-repeat="inParam in inParams" layout="row"  layout-align="center center">
                                            <input type="text" class="form-control" ng-model="inParam.text" placeholder="{{translate('parameter') + ' ' + ($index+1)}}">
                                            <span flex="10" class="text-center" ng-if="inParams.length > 1"><i class="fa fa-times" aria-hidden="true" ng-click="inParams.splice($index,1)"></i></span>
                                        </div>
                                        <button class="btn btn-default" ng-click="backToOperation()">
                                            {{translate("back")}}
                                        </button>
                                        <button class="btn btn-primary" ng-click="createFilterExpressionFromArray(inParams)">
                                            {{translate("add")}}
                                        </button>
                                    </div>
                                    <div ng-if="selectedOperation.value.name !== 'in'">
                                        <div class="form-group">
                                            <label for="text-param">{{translate("parameter")}}</label>
                                            <input type="text" class="form-control" id="text-param" ng-model="params">
                                        </div>
                                        <button class="btn btn-default" ng-click="backToOperation()">
                                            {{translate("back")}}
                                        </button>
                                        <button class="btn btn-primary" ng-click="createFilterExpression(params)"  ng-disabled="params === undefined">
                                            {{translate("add")}}
                                        </button>
                                    </div>
                                </div>
                                <div ng-switch-when="number">
                                    <div ng-if="selectedOperation.value.name === 'between'">
                                        <div class="form-group">
                                            <label for="between-param1">{{translate("from")}}</label>
                                            <input type="number" class="form-control" id="between-param1"
                                                   ng-model="params">
                                        </div>
                                        <div class="form-group">
                                            <label for="between-param2">{{translate("to")}}</label>
                                            <input type="number" class="form-control" id="between-param2"
                                                   ng-model="params2">
                                        </div>
                                        <button class="btn btn-default" ng-click="backToOperation()">
                                            {{translate("back")}}
                                        </button>
                                        <button class="btn btn-primary" ng-click="createFilterExpression(params,params2)"  ng-disabled="params === undefined || params2 === undefined || params >= params2">
                                            {{translate("add")}}
                                        </button>
                                    </div>
                                    <div ng-if="selectedOperation.value.name === 'in'" ng-init="inParams = [{}]">
                                        <a href="" ng-click="inParams.push({})">{{translate("add_param")}}</a>
                                        <div class="form-group" ng-repeat="inParam in inParams" layout="row"  layout-align="center center">
                                            <input type="number" class="form-control" ng-model="inParam.text" placeholder="{{translate('parameter') + ' ' + ($index+1)}}">
                                            <span flex="10" class="text-center" ng-if="inParams.length > 1"><i class="fa fa-times" aria-hidden="true" ng-click="inParams.splice($index,1)"></i></span>
                                        </div>
                                        <button class="btn btn-default" ng-click="backToOperation()">
                                            {{translate("back")}}
                                        </button>
                                        <button class="btn btn-primary" ng-click="createFilterExpressionFromArray(inParams)">
                                            {{translate("add")}}
                                        </button>
                                    </div>
                                    <div ng-if="selectedOperation.value.name !== 'between' && selectedOperation.value.name !== 'in'">
                                        <div class="form-group">
                                            <label for="number-param">{{translate("number")}}</label>
                                            <input type="number" class="form-control" id="number-param"
                                                   ng-model="params">
                                        </div>
                                        <button class="btn btn-default" ng-click="backToOperation()">
                                            {{translate("back")}}
                                        </button>
                                        <button class="btn btn-primary" ng-click="createFilterExpression(params)"  ng-disabled="params === undefined">
                                            {{translate("add")}}
                                        </button>
                                    </div>
                                </div>
                                <div ng-switch-when="dateTime">
                                    <div ng-if="selectedOperation.value.name === 'between'">
                                        <div class="form-group">
                                            <label for="between-param1">{{translate("from")}}</label>
                                            <module-template name="inputs/dateTimePicker" data="dateTimeOptions1"></module-template>
                                        </div>
                                        <div class="form-group">
                                            <label for="between-param2">{{translate("to")}}</label>
                                            <module-template name="inputs/dateTimePicker" data="dateTimeOptions2"></module-template>
                                        </div>
                                        <button class="btn btn-default" ng-click="backToOperation()">
                                            {{translate("back")}}
                                        </button>
                                        <button class="btn btn-primary" ng-click="createDateExpression()"  ng-disabled="dateParam1 === undefined || dateParam2 === undefined">
                                            {{translate("add")}}
                                        </button>
                                    </div>
                                    <div ng-if="selectedOperation.value.name !== 'between'">
                                        <div class="form-group">
                                            <label for="number-param">{{translate("date")}}</label>
                                            <module-template name="inputs/dateTimePicker" data="dateTimeOptions1"></module-template>
                                        </div>
                                        <button class="btn btn-default" ng-click="backToOperation()">
                                            {{translate("back")}}
                                        </button>
                                        <button class="btn btn-primary" ng-click="createDateExpression()"  ng-disabled="dateParam1 === undefined">
                                            {{translate("add")}}
                                        </button>
                                    </div>
                                </div>
                                <div ng-switch-when="enum">
                                    <div ng-if="selectedOperation.value.name === 'in'" ng-init="inParams = [{}]">
                                        <a href="" ng-click="inParams.push({})">{{translate("add_param")}}</a>
                                        <div class="form-group" ng-repeat="inParam in inParams" layout="row" layout-align="center center">
                                            <md-input-container>
                                                <label>{{translate("parameter")}}</label>
                                                <md-select ng-model="inParam.text">
                                                    <md-option ng-repeat="constant in currentFilterExpression.field.info.constants" value="{{constant}}">
                                                        {{constant}}
                                                    </md-option>
                                                </md-select>
                                            </md-input-container>
                                            <span flex="10" class="text-center" ng-if="inParams.length > 1"><i class="fa fa-times" aria-hidden="true" ng-click="inParams.splice($index,1)"></i></span>
                                        </div>
                                        <button class="btn btn-default" ng-click="backToOperation()">
                                            {{translate("back")}}
                                        </button>
                                        <button class="btn btn-primary" ng-click="createFilterExpressionFromArray(inParams)">
                                            {{translate("add")}}
                                        </button>
                                    </div>
                                    <div ng-if="selectedOperation.value.name !== 'in'">
                                        <div class="form-group">
                                            <md-input-container>
                                                <label>{{translate("parameter")}}</label>
                                                <md-select ng-model="params">
                                                    <md-option ng-repeat="constant in currentFilterExpression.field.info.constants" value="{{constant}}">
                                                        {{constant}}
                                                    </md-option>
                                                </md-select>
                                            </md-input-container>
                                        </div>
                                        <button class="btn btn-default" ng-click="backToOperation()">
                                            {{translate("back")}}
                                        </button>
                                        <button class="btn btn-primary" ng-click="createFilterExpression(params)"  ng-disabled="params === undefined">
                                            {{translate("add")}}
                                        </button>
                                    </div>
                                </div>
                                <div ng-switch-when="check_box" ng-init="params = false">
                                    <md-switch ng-model="params" aria-label="Switch params">
                                        {{translate("parameter")}} : {{ params }}
                                    </md-switch>
                                    <button class="btn btn-default" ng-click="backToOperation()">
                                        {{translate("back")}}
                                    </button>
                                    <button class="btn btn-primary" ng-click="createFilterExpression(params)" ng-disabled="params === undefined">
                                        {{translate("add")}}
                                    </button>
                                </div>
                            </div>

                        </div>

                    </div>
                </div>  <!--.row-->
                <div>
                    <md-radio-group ng-model="logicalExpression" layout="row" layout-align="center">
                        <p class="filter-logical-operation">{{translate("filter_join_by")}}</p>
                        <md-radio-button value="and" class="md-primary">{{translate("and")}}</md-radio-button>
                        <md-radio-button value="or">{{translate("or")}}</md-radio-button>
                    </md-radio-group>
                </div>
            </div>
            <div class="modal-footer modal-find">
                <button type="button" class="btn btn-default" ng-disabled="!(filterRequest.length > 0)"
                        ng-click="clearFilter()">{{translate("clear_filter")}}
                </button>
                <button type="button" class="btn btn-primary" ng-disabled="currentFilterExpression.field"
                        ng-click="saveFilter()">{{translate("do_filter")}}
                </button>
                <button type="button" class="btn btn-danger" ng-click="closeModal()">{{translate("close")}}</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->